<!doctype html>
<html lang="zh">

<head>
	<meta charset="UTF-8">
	<title>æ—¶é—´çš„æœ‹å‹|æ•°ç‹¬</title>
	<link href="images/favicon_books.ico" rel="shortcut icon">
	<link href="css/head.css" type="text/css" rel="stylesheet">
	<link href="css/default.css" type="text/css" rel="stylesheet">
	<link href="css/foot.css" type="text/css" rel="stylesheet">
	<link href="css/font-awesome.min.css" rel="stylesheet">

	<script src="js/solver.js"></script>
</head>

<body>
	<!--é¡µå¤´-->
	<div class="head">
		<i class="fa fa-sort-numeric-asc" aria-hidden="true"></i> sudoku | æ•°ç‹¬åœ¨çº¿æ±‚è§£å™¨
	</div>

	<div id='sudoku'>
		<div class="banner">
		  <a href="https://github.com/taketimeasafriend/sudoku" target="view_window" class="myButton"><i class="fa fa-github"></i> - Fork on Github - </a>
    </div>
		<div id='main'>
			<table>
				<tr>
					<td>
						<br/>
						<canvas id='canvas1' width='541' height='541'>Canvas is not supported by this browser.</canvas>
						ç‚¹å‡»è¾“å…¥:
						<canvas id='canvas2' width='541' height='55' title="Click here to set the currently selected digit">Canvas is not supported by this browser.</canvas>
						æ•°ç‹¬æ¡†å¯¹åº”æ•°å­—æ–‡æœ¬:
						<input id='tbSerial' style='width: 538px; background-color: #eee; margin-top: 5px; font-size: 1.0em;' />
						<br/>
					</td>
					<td style="width: 135px">
						<button onclick="clearGame()" title='æ¸…ç©ºæ‰€æœ‰æ•°æ®(ç”¨äºæ–°å»ºé¢˜ç›®æ—¶åˆå§‹åŒ–)'>æ¸…ç©ºæ‰€æœ‰</button><br/>
						<button onclick="loadText()" title='Loads the digits from the textbox below the board in order left to right, top to bottom. Click this after entering a problem to convert them to givens'>è½½å…¥</button><br/>
						<button id="btnReset" onclick="reset()" title='æ¸…ç©ºç”¨æˆ·è¾“å…¥çš„æ•°å­—(é¢˜ç›®ä¸è¢«æ¸…ç©º)'>é‡æ–°ç­”é¢˜</button><br/>
						<button id="btnAccept" onclick="acceptPossibles()" title='å¡«å…¥å°çš„çº¢è‰²æç¤ºæ•°å­—'>å¡«å…¥çº¢è‰²æç¤ºæ•°å­—</button><br/>
						<button id="btnHint" onclick="hint()" title='å¡«å…¥å½“å‰é€‰å®šå•å…ƒæ ¼(æµ…çº¢è‰²èƒŒæ™¯)çš„æ­£ç¡®ç­”æ¡ˆ'>è§£ç­”å·²é€‰å®šå•å…ƒæ ¼</button><br/>
						<button id="btnUndo" onclick="undo()" title='é‡åšä¸Šä¸€æ­¥(ä¸åŒ…æ‹¬â€œæ¸…ç©ºæ‰€æœ‰â€â€œé‡æ–°ç­”é¢˜â€)'>ä¸Šä¸€æ­¥</button><br/>
						<button id="btnSolve" onclick="solve()" title='æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ(å¦‚æœé¢˜ç›®æœ‰è§£)(ç¨‹åºè€—æ—¶å°†æ˜¾ç¤ºåœ¨æœ€ä¸‹æ–¹)'>çœ‹ç­”æ¡ˆ</button><br/>
						<div class="messageout">
						<input id='chbAllowed' type="checkbox" checked='yes' title='æ¯ä¸ªå•å…ƒæ ¼æ˜¾ç¤ºçš„å°æ•°å­—å³ä¸ºå…è®¸æ•°å­—'/>
						æ˜¾ç¤ºå…è®¸æ•°å­—
						<br/><input id='chbShowSingles' type="checkbox" checked='yes' title='æ¯ä¸ªå•å…ƒæ ¼æ ‡ç¤ºä¸ºçº¢è‰²çš„å°æ•°å­—å³ä¸ºå”¯ä¸€å…è®¸çš„æ•°å­—' />
						æ ‡ç¤ºå”¯ä¸€æ•°å­—
						<br/>
						<div id="message" style="margin-top: 50px; width: 120; color: Red;"></div><br/>
						<div id="extraInfo" style='font-size:0.8em; color: #696969;'></div>
						</div>
					</td>
					<td class="help">
						<h2>ğŸ”˜æŒ‰é’®è¯´æ˜</h2>
						<ul>
							<li>â€œæ¸…ç©ºæ‰€æœ‰â€ - æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼Œç”¨äºæ–°å»ºé¢˜ç›®æ—¶åˆå§‹åŒ–(ç¨‹åºé»˜è®¤ç»™äº†ä¸€é“é¢˜ç›®)ã€‚å¯ä»¥é¼ æ ‡ç‚¹å‡»ç•Œé¢å•å…ƒæ ¼è¾“å…¥ï¼Œæˆ–è€…ç”¨é”®ç›˜æ–¹å‘é”®é…åˆè¾“å…¥ 1 - 9ã€‚</li>
							<li>â€œè½½å…¥â€ - å·²ç»å¡«å…¥çš„æ•°å­—å°†è¢«å›ºå®šï¼ˆè“è‰²æ ‡ç¤ºï¼‰ï¼Œç‚¹å‡»â€œé‡æ–°ç­”é¢˜â€æ—¶æ•°å­—ä¸ä¼šè¢«æ¸…ç©ºã€‚</li>
							<li>â€œé‡æ–°ç­”é¢˜â€ - æ¸…ç©ºç”¨æˆ·è¾“å…¥çš„æ•°å­—ã€‚(é¢˜ç›®ä¸è¢«æ¸…ç©º)</li>
							<li>â€œå¡«å…¥çº¢è‰²æç¤ºæ•°å­—â€ - å¡«å…¥å°çš„çº¢è‰²æç¤ºæ•°å­—ã€‚</li>
							<li>â€œè§£ç­”å·²é€‰å®šå•å…ƒæ ¼â€ - å¡«å…¥å½“å‰é€‰å®šå•å…ƒæ ¼(æµ…çº¢è‰²èƒŒæ™¯)çš„æ­£ç¡®ç­”æ¡ˆã€‚</li>
							<li>â€œä¸Šä¸€æ­¥â€ - é‡åšä¸Šä¸€æ­¥(ä¸åŒ…æ‹¬â€œæ¸…ç©ºæ‰€æœ‰â€å’Œâ€œé‡æ–°ç­”é¢˜â€)</li>
							<li>â€œçœ‹ç­”æ¡ˆâ€ - æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ(å¦‚æœé¢˜ç›®æœ‰è§£)ï¼Œç¨‹åºè€—æ—¶å°†æ˜¾ç¤ºåœ¨æœ€ä¸‹æ–¹ã€‚æ­¤æ­¥å¯æ’¤é”€ã€‚</li>
							<li>æ¯ä¸ªå•å…ƒæ ¼å…è®¸å¡«å…¥çš„æ•°å­—å°†ä»¥å°å·ç°è‰²æ ‡ç¤ºå‡ºã€‚ï¼ˆå¯å‹¾é€‰æ˜¯å¦â€œæ˜¾ç¤ºå…è®¸æ•°å­—â€ï¼‰</li>
							<li>å½“æ¯ä¸ªå•å…ƒæ ¼è¢«å…è®¸å¡«å…¥çš„æ•°å­—å”¯ä¸€ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å­—å°†çº¢è‰²é«˜äº®æ ‡ç¤ºã€‚ï¼ˆå¯å‹¾é€‰æ˜¯å¦â€œæ ‡ç¤ºå”¯ä¸€æ•°å­—â€ï¼‰</li>
							<li>PS: ç‚¹å‡»å·²ç»è¾“å…¥æ•°å­—çš„å•å…ƒæ ¼ï¼Œæ‰€æœ‰å’Œæ­¤å•å…ƒæ ¼æ•°å­—ç›¸åŒçš„å•å…ƒæ ¼éƒ½ä¼šçº¢è‰²é«˜äº®ã€‚</li>

						</ul>
					</td>
				</tr>
			</table>

			<script type="text/javascript">
				var CellSize = 60;
				var SubCellSize = 18;

				var canvas1 = document.getElementById("canvas1");
				var canvas2 = document.getElementById("canvas2");
				var chbAllowed = document.getElementById("chbAllowed");
				var chbShowSingles = document.getElementById("chbShowSingles");
				var tbSerial = document.getElementById("tbSerial");
				var extraInfo = document.getElementById("extraInfo");

				var board1 = new Board();
				var selectRow = 0;
				var selectCol = 0;
				var showAllowed = true;
				var showSingles = true;
				var undoStack = Array();

				function undo() {
					var tos = undoStack.pop();
					if (tos) {
						board1 = tos;
						updateUI();
					}
				}

				function clearUndo() {
					undoStack = Array();
				}

				function pushBoard() {
					undoStack.push(board1.clone());
				}

				function checkStatus() {
					extraInfo.innerHTML = "";
					if (!board1._isValid)
						message.innerHTML = "*Invalid*";
					else if (board1._isSolved)
						message.innerHTML = "ç­”é¢˜å®Œæ¯•";
					else
						message.innerHTML = "";
				}

				function drawGrid() {
					// Only ever called once!
					var context = canvas1.getContext('2d');
					context.strokeStyle = '#c00';
					for (var i = 0; i <= BoardSize; i++) {
						context.beginPath();
						var thick = i % 3 == 0;
						// Draw vertical lines
						context.lineWidth = thick ? 2 : 1;
						context.moveTo(i * CellSize + 0.5, 0.5);
						context.lineTo(i * CellSize + 0.5, BoardSize * CellSize + 0.5);

						// Draw horizontal lines
						context.moveTo(0.5, i * CellSize + 0.5);
						context.lineTo(BoardSize * CellSize + 0.5, i * CellSize + 0.5);
						context.stroke();
					}
				}

				function drawCells() {
					var context = canvas1.getContext('2d');

					context.font = "12pt Calibri"; // small text
					context.textAlign = "center";
					context.textBaseline = "middle";
					var normalColor = "#aaaaaa";
					var singleColor = "#ff143c";

					// Draw background for selected cell
					for (var row = 0; row < BoardSize; row++)
						for (var col = 0; col < BoardSize; col++) {

							// Draw background of selected cell
							if (row == selectRow && col == selectCol) {
								var margin = 2;
								context.beginPath();
								context.rect(col * CellSize + margin + 0.5, row * CellSize + margin + 0.5, CellSize - 2 * margin, CellSize - 2 * margin);
								context.fillStyle = "#ffe4e1";
								context.fill()
							}
						}
					context.fillStyle = "#999999"; // text color - light

					// Draw allowed values
					if (showAllowed)
						for (var row = 0; row < BoardSize; row++)
							for (var col = 0; col < BoardSize; col++) {
								var cell = board1.getCell(new Location(row, col));
								if (!cell.isAssigned()) {
									var allowedValues = cell._allowed.allowedValuesArray();
									for (var i = 0; i < allowedValues.length; i++) {
										var val = allowedValues[i];
										var x = (col + 0.5) * CellSize; // center of cell for textAlign center, textBaseline middle
										var y = (row + 0.5) * CellSize;
										var subRow = Math.floor((val - 1) / 3) - 1;
										var subCol = Math.floor((val - 1) % 3) - 1;
										x += subCol * SubCellSize;
										y += subRow * SubCellSize;
										var hiddenSingle = allowedValues.length != 1 && val == cell.getAnswer(); // naked single would have only one allowed value
										context.fillStyle = normalColor; // show hidden single in purple
										if (showSingles && val == cell.getAnswer())
											context.fillStyle = singleColor; // show hidden single in purple
										context.fillText(val, x, y);
									}
								}
							}

					// New if a digit is selected then make all cells with the same digit foreground red
					var selectCell = board1.getCell(new Location(selectRow, selectCol));
					var selectValue = selectCell.getValue();

					// Draw values last
					context.font = "32pt Calibri";
					context.textAlign = "center";
					context.textBaseline = "middle";
					var normalForeColor = "#191929";
					var sameDigitForeColor = "#F91919";
					context.fillStyle = normalForeColor; // text color - dark
					for (var row = 0; row < BoardSize; row++)
						for (var col = 0; col < BoardSize; col++) {
							var cell = board1.getCell(new Location(row, col));
							var x = (col + 0.5) * CellSize; // center of cell for textAlign center, textBaseline middle
							var y = (row + 0.5) * CellSize;
							var sameDigit = cell.getValue() == selectValue && selectValue != 0;
							// Draw value
							var value = cell.getValue();
							if (value != 0) {
								context.fillStyle = cell.isGiven() ? "#2200aa" : "#696969"; // show "givens" in a darker color
								if (sameDigit) // then override
									context.fillStyle = sameDigitForeColor; // text color - dark
								context.fillText(value, x, y);
							}
						}
				}

				function drawCanvas() {
					canvas1.width = canvas1.width;
					drawGrid();
					drawCells();
				}

				function updateUI() {
					drawCanvas();
					checkStatus();
					tbSerial.value = board1.toString();
				}

				function readOptions() {
					showAllowed = chbAllowed.checked;
					showSingles = chbShowSingles.checked;
					drawCanvas();
				}

				chbAllowed.onclick = readOptions;
				chbShowSingles.onclick = readOptions;

				function selectCell(row, col) {
					selectRow = row;
					selectCol = col;
					drawCanvas();
				}

				function moveSelection(row, col) {
					selectRow += row;
					selectCol += col;
					if (selectRow < 0)
						selectRow = 8;
					else if (selectRow > 8)
						selectRow = 0;
					if (selectCol < 0)
						selectCol = 8;
					else if (selectCol > 8)
						selectCol = 0;
					drawCanvas();
				}

				function setDigitInCell(digit) {
					var cell = board1.getCell(new Location(selectRow, selectCol));
					message.innerHTML = "";
					if (cell.isGiven())
						return;
					if (digit != 0 && !cell.isAllowed(digit)) {
						message.innerHTML = "è¾“å…¥æœ‰è¯¯";
						return;
					}
					pushBoard();
					cell.setValue(digit);
					board1.updateAllowed();
					updateUI();
				}

				canvas1.onmousedown = function canvasMouseDown(ev) {
					var x = ev.pageX - this.offsetLeft;
					var y = ev.pageY - this.offsetTop;
					var coords = this.relMouseCoords(ev);
					selectCell(Math.floor(coords.y / CellSize), Math.floor(coords.x / CellSize));
				}

				document.onkeydown = function(ev) {
					switch (ev.keyCode) {
						case 37: // left arrow
							moveSelection(0, -1);
							break;
						case 38: // up arrow
							moveSelection(-1, 0);
							break;
						case 39: // right arrow
							moveSelection(0, 1);
							break;
						case 40: // down arrow
							moveSelection(1, 0);
							break;
						default:
							var key = Number(ev.keyCode);
							var digit = key >= 96 ? key - 96 : key - 48; // handle keypad digits as well
							if (digit >= 0 && digit <= 9)
								setDigitInCell(digit);
							break;
					}
				}

				function loadText() {
					var ret = board1.setString(tbSerial.value);
					updateUI();
					if (!ret)
						message.innerHTML = "String is not of length 81";
				}

				function clearGame() {
					clearUndo();
					board1.clear();
					updateUI();
				}

				function acceptPossibles() {
					pushBoard();
					board1.acceptPossibles();
					board1.updateAllowed();
					updateUI();
				}

				function hint() {
					// First check if we had calculated a solution, if not do so now
					solution = board1.clone();
					if (solution.trySolve(Location.empty, 0)) {
						// There is a solution to the board from its current state
						var cell = solution.getCell(new Location(selectRow, selectCol));
						if (!cell.isGiven())
							setDigitInCell(cell.getValue());
					}
				}

				function reset() {
					clearUndo();
					board1.reset();
					updateUI();
				}

				function solve() {
					pushBoard();
					var n = new Date(); // Grab new copy of date
					var s = n.getTime(); // Grab current millisecond #
					board1.trySolve(Location.empty, 0);
					var diff = new Date().getTime() - s;
					updateUI();
					extraInfo.innerHTML = "è§£é¢˜è€—æ—¶:" + String(diff) + "milliseconds";
				}

				//http://magictour.free.fr/sudoku.htm for list of hard Sudoku puzzles
				// http://www.sudokuwiki.org/sudoku.htm good on-line solver accepting serial format
				//board1.setString("7.8...3.....2.1...5.........4.....263...8.......1...9..9.6....4....7.5..........."); //very hard
				board1.setString("7.8...3.....2.1...5..7..2...4.....263.948...7...1...9..9.6....4....7.5....5......"); // medium
				updateUI();
				var digCellSize = 54;

				// New stuff - draw a digit selector in canvas above board
				function initDigitSource() {
					// Only ever called once!
					var context = canvas2.getContext('2d');
					context.strokeStyle = '#070';
					var SourceSize = BoardSize + 1;
					for (var i = 0; i <= SourceSize; i++) {
						context.beginPath();
						// Draw vertical lines
						context.lineWidth = 1;
						context.moveTo(i * digCellSize + 0.5, 0.5);
						context.lineTo(i * digCellSize + 0.5, digCellSize + 0.5);
						context.stroke();
					}
					for (var i = 0; i <= 1; i++) {
						context.beginPath();
						// Draw horizontal lines
						context.lineWidth = 1;
						context.moveTo(0.5, i * digCellSize + 0.5);
						context.lineTo(SourceSize * digCellSize + 0.5, i * digCellSize + 0.5);
						context.stroke();
					}
					context.font = "24pt Calibri";
					context.textAlign = "center";
					context.textBaseline = "middle";
					var normalForeColor = "#708090";
					context.fillStyle = normalForeColor; // text color - dark
					for (var col = 0; col < SourceSize; col++) {
						var x = (col + 0.5) * digCellSize; // center of cell for textAlign center, textBaseline middle
						var y = 0.5 * digCellSize;
						var value = col < 9 ? col + 1 : "X";
						context.fillStyle = normalForeColor; // show "givens" in a darker color
						context.fillText(value, x, y);
					}

				}
				initDigitSource();

				canvas2.onmousedown = function canvasMouseDown(ev) {
					var x = ev.pageX - this.offsetLeft;
					var y = ev.pageY - this.offsetTop;
					var coords = this.relMouseCoords(ev);
					var dig = Math.floor(coords.x / digCellSize) + 1;
					if (dig == 10)
						dig = 0;
					setDigitInCell(dig);
				}
			</script>
		</div>

	</div>
	<!--é¡µè„š-->
	<div class="foot">
		<a href="http://51world.win" target="view_window"><i class="fa fa-home"></i>ä¸»é¡µ</a>
		 -
		<a href="https://github.com/taketimeasafriend" target="view_window"><i class="fa fa-github"></i>Github</a>
		 -
		<a href="http://weibo.com/miaoxiaogege" target="view_window"><i class="fa fa-weibo"></i>å¾®åš</a>
		 -
		<a href="http://ogudt6aal.bkt.clouddn.com/image/whynotwangwei.jpeg" target="view_window"><i class="fa fa-weixin"></i>å¾®ä¿¡</a>
		 -
		<a href="mailto:taketimeasafriend@gmail.com?subject=I%20want%20to%20say%20&body=Hello%20"><i class="fa fa-envelope"></i>é‚®ç®±</a>
	</div>
</body>

</html>
